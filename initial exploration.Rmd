---
title: "mp3"
output: html_document
---
QUESTIONS FOR WEDNESDAY:

Make sure buffers are right size
Remote Campsite location???
Forest Aggregation

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(macleish)
library(tidyverse)
library(sf)
library(leaflet)
library(data.table)
library(units)
```

```{r}
trails<-macleish_layers[["trails"]]
boundary<-macleish_layers[["boundary"]]

streams<-macleish_layers[["streams"]]
wetlands<-macleish_layers[["wetlands"]]

forests<-macleish_layers[["forests"]]

research<-macleish_layers[["research"]]
buildings<-macleish_layers[["buildings"]]

landmarks<-macleish_layers[["landmarks"]]
challengecourses<-macleish_layers[["challenge_courses"]]
contours <- macleish_layers[["contours_3m"]]
```

```{r}
<<<<<<< HEAD
dsn <- path.expand("contour")
dsn
list.files(dsn)
contour_layer <- read_sf(dsn)
st_layers(dsn)

contour_layer <- st_transform(contour_layer, crs = 4326)

boundelev <- boundary %>%
  st_intersection(contour_layer)

boundelev%>%
  plot()
 
boundelev %>%
  arrange(CONTOUR_FT)

proj4_aea <- "+proj=aea +lat_1=29.5 +lat_2=42.5 +lat_0=37.5 +lon_0=-96 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs"

point_to_sf <- function(lat, lon) {
  st_point(c(lat,lon)) %>%
    st_sfc(crs = 4326)
}

parking <- point_to_sf(-72.680663, 42.448013) %>%
  st_transform(crs = proj4_aea)
group_campsite <- point_to_sf(-72.678154, 42.450976)
remote_campsite <- point_to_sf(-72.674732, 42.458570)

 
 

library(leaflet)
leaflet() %>%
  addTiles %>%
  addPolygons(data = boundary, weight = 1, fillOpacity = 0.1) %>%
  addMarkers(data = st_transform(parking, crs = 4326), popup = "Parking") %>%
  addMarkers(data = group_campsite, popup = "Group Campsite") %>%
  addMarkers(data = remote_campsite, popup = "Remote Campsite") %>%
  addPolygons(data = parking_buffer, weight = 1, opacity = 0.1) %>%
  addPolygons(data = buildings, weight = 1, opacity = 1) 
#1/2 mile from parking area

#within 200` of a stream/water source

#in a forest unlike the forest the other 2 are in

#relatively flat

#at least 500` from any research area or challenge course

library(data.table)
campground<-data.table(campsite=c("Group Campsite", "Remote Campsite"), longitude=c(42.450976, 42.458570), latitude=c(-72.678154, -72.674732))

campgroundsf<-st_as_sf(campground, coords = c("longitude", "latitude"), crs = 4326)

parking<-data.table(parking="Parking lot", longitude=42.448013, latitude=-72.680663)

parkingsf<-st_as_sf(parking, coords = c("longitude", "latitude"), crs = 4326)

macleish_layers[["boundary"]]

boundelev %>%
  arrange(CONTOUR_FT)

=======
>>>>>>> e3d6146c8ea7b8f05bb3239356339c6894eed0f2
proj4_aea <- "+proj=aea +lat_1=29.5 +lat_2=42.5 +lat_0=37.5 +lon_0=-96 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs"

point_to_sf <- function(lat, lon) {
  st_point(c(lat,lon)) %>%
    st_sfc(crs = 4326)
}

parking <- point_to_sf(-72.680663, 42.448013) %>%
  st_transform(crs = proj4_aea)
group_campsite <- point_to_sf(-72.678154, 42.450976)
remote_campsite <- point_to_sf(-72.674732, 42.458570)

# put 1/2 mi (804.672 m) buffer around parking area
parking_buffer <- st_buffer(parking, dist = 402.336) %>%
  st_transform(crs = 4326)

streams_inside <- boundary %>%
  st_intersection(streams)
<<<<<<< HEAD
library(units)
=======

parkbuffer<-parking%>%
  st_transform(proj4_aea)%>%
  st_buffer(dist= 402.336)%>%
  st_transform(4326)
  
>>>>>>> 046e98e8033b431375fba15b5f6e21470cf695dd
streams_buffer <- streams_inside %>%
  st_transform(proj4_aea) %>%
  st_buffer(dist = 30.48) %>%
  st_transform(4326)

ccbuffer<-challengecourses%>%
  st_transform(proj4_aea) %>%
  st_buffer(dist = 68.58) %>%
  st_transform(4326)
```

<<<<<<< HEAD

MacLeish currently has two campsites - one large group site closer to the building and one remote campsite with two tent platforms about one mile from the parking area. We would like to develop one additional campsite that is approximately half a mile walk from the parking area, within 200’ of a stream or other source of water, in forest that is unlike the forest in the two other campsites, relatively flat, and at least 500’ from any research area or any element of the Challenge Course. Propose two new campsite locations for our consideration.
Supporting data includes:
Existing trails shapefile
10’ contour elevation data
vegetation type shapefile
hydrology (streams, wetlands, etc.) shapefile
Research locations shapefile
Challenge course element locations shapefile
Property Boundary shapefile
=======
```{r}
<<<<<<< HEAD
library(macleish)
=======
bechtel <- data.frame(lat = 42.449167, lon = -72.679389)

<<<<<<< HEAD
>>>>>>> 046e98e8033b431375fba15b5f6e21470cf695dd
pal <- colorNumeric(palette = "inferno",
                    domain = macleish_layers[["contours_3m"]]$)
library(RColorBrewer)
factpal <- colorNumeric(topo.colors(5), macleish_layers$contours_3m)
=======
pale <- colorNumeric(palette = "inferno",
                    domain = contours$ELEV_M)
>>>>>>> e3d6146c8ea7b8f05bb3239356339c6894eed0f2
leaflet() %>%
  addTiles %>%
  addPolygons(data = boundary, weight = 1, fillOpacity = 0.1) %>%
  addMarkers(data = st_transform(parking, crs = 4326), popup = "Parking") %>%
  addMarkers(data = group_campsite, popup = "Group Campsite") %>%
  addMarkers(data = remote_campsite, popup = "Remote Campsite") %>%
<<<<<<< HEAD
  addPolygons(data = parking_buffer, color = "green") %>%
  addPolylines(data = streams_buffer, fillOpacity = 0.5) %>%
  addPolygons(data = buildings, weight = 1, opacity = 1) %>%
  addPolygons(data = boundelev, color = ~factpal(variable name)) %>%
  addTiles()%>%
  addLegend(map, position = c("bottomright"), pal = ~pal(boundelev[["CONTOUR_FT"]]), opacity = 1, title = 'An', values = variable name)

plot(contour_layer)
=======
  addPolygons(data = parking_buffer, color = "red") %>%
  addPolylines(data = streams_buffer, fillOpacity = 0.5, color="green")%>%
  addPolygons(data = researchbuffer,fillOpacity = 0, weight=.5)%>%
  addPolygons(data=ccbuffer, fillOpacity = 0, weight=.5)%>%
  addPolygons(data=wetlands)%>%
  addMarkers(data=challengecourses)%>%
  addPolygons(data=research)%>%
  addMarkers(lng = ~lon, lat = ~lat, data = bechtel,
             popup = "Bechtel Environmental Classroom") %>%
  addPolygons(data = contours, color = ~pale(ELEV_M), weight = 0.5) %>%
  addLegend(pal = pale, values = contours$ELEV_M)

plot(boundelev["CONTOUR_FT"])
>>>>>>> 046e98e8033b431375fba15b5f6e21470cf695dd
            #, pal = pal, values = ~CONTOUR_FT,
    #title = "Contour Elevation",
    #opacity = 1)
```
```{r}
library(macleish)
?contours_3m
```
 


#1/2 mile from parking area

#within 200` of a stream/water source

#in a forest unlike the forest the other 2 are in: Campsite cannot be in Red-Oak forest

relatively flat

<<<<<<< HEAD
at least 500` from any research area or challenge course
<<<<<<< HEAD
```{r}

```

=======
=======
#at least 500` from any research area or challenge course
>>>>>>> 046e98e8033b431375fba15b5f6e21470cf695dd

Group Campsite (42.450976, -72.678154)
Remote Campite (42.458570, -72.674732)
Parking (42.448013, -72.680663)


#FOREST AGGREGATION

```{r}
aggforests%>%
  group_by(Sheet1__Na)%>%
  mutate(area=st_area(geometry))

plot(forests["Sheet1__Na"])
```
 
```{r}
names(macleish_layers)
```


