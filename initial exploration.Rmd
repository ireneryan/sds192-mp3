---
title: "mp3"
output: html_document
---
QUESTIONS FOR WEDNESDAY:

Make sure buffers are right size
Remote Campsite location???
Forest Aggregation

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(macleish)
library(tidyverse)
library(sf)
library(leaflet)
library(data.table)
library(units)
```

```{r}
trails<-macleish_layers[["trails"]]
boundary<-macleish_layers[["boundary"]]

streams<-macleish_layers[["streams"]]
wetlands<-macleish_layers[["wetlands"]]

forests<-macleish_layers[["forests"]]

research<-macleish_layers[["research"]]
buildings<-macleish_layers[["buildings"]]

landmarks<-macleish_layers[["landmarks"]]
challengecourses<-macleish_layers[["challenge_courses"]]

contours30ft<-macleish_layers[["contours_30ft"]]

contours3m<-macleish_layers[["contours_3m"]]
```

```{r}
proj4_aea <- "+proj=aea +lat_1=29.5 +lat_2=42.5 +lat_0=37.5 +lon_0=-96 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs"

point_to_sf <- function(lat, lon) {
  st_point(c(lat,lon)) %>%
    st_sfc(crs = 4326)
}

parking <- point_to_sf(-72.680663, 42.448013) %>%
  st_transform(crs = proj4_aea)
group_campsite <- point_to_sf(-72.678154, 42.450976)
remote_campsite <- point_to_sf(-72.674732, 42.458570)

# put 1/2 mi (804.672 m) buffer around parking area
parking_buffer <- st_buffer(parking, dist = 402.336) %>%
  st_transform(crs = 4326)

streams_inside <- boundary %>%
  st_intersection(streams)

parkbuffer<-parking%>%
  st_transform(proj4_aea)%>%
  st_buffer(dist=set_units(402.336, m))%>%
  st_transform(4326)
  
streams_buffer <- streams_inside %>%
  st_transform(proj4_aea) %>%
  st_buffer(dist = set_units(100, m)) %>%
  st_transform(4326)

ccbuffer<-challengecourses%>%
  st_transform(proj4_aea) %>%
  st_buffer(dist = set_units(225, m)) %>%
  st_transform(4326)
```

```{r}
bechtel <- data.frame(lat = 42.449167, lon = -72.679389)

pal <- colorNumeric(palette = "inferno",
                    domain = boundelev[["CONTOUR_FT"]])
leaflet() %>%
  addTiles %>%
  addPolygons(data = boundary, weight = 1, fillOpacity = 0.1) %>%
  addMarkers(data = st_transform(parking, crs = 4326), popup = "Parking") %>%
  addMarkers(data = group_campsite, popup = "Group Campsite") %>%
  addMarkers(data = remote_campsite, popup = "Remote Campsite") %>%
  addPolygons(data = parking_buffer, color = "red") %>%
  addPolylines(data = streams_buffer, fillOpacity = 0.5, color="green")%>%
  addPolygons(data=researchbuffer,fillOpacity = 0, weight=.5)%>%
  addPolygons(data=ccbuffer, fillOpacity = 0, weight=.5)%>%
  addPolygons(data=wetlands)%>%
  addMarkers(data=challengecourses)%>%
  addPolygons(data=research)%>%
 addMarkers(lng = ~lon, lat = ~lat, data = bechtel,
             popup = "Bechtel Environmental Classroom")

plot(boundelev["CONTOUR_FT"])
            #, pal = pal, values = ~CONTOUR_FT,
    #title = "Contour Elevation",
    #opacity = 1)
```


#1/2 mile from parking area

#within 200` of a stream/water source

#in a forest unlike the forest the other 2 are in: Campsite cannot be in Red-Oak forest

relatively flat

#at least 500` from any research area or challenge course

Group Campsite (42.450976, -72.678154)
Remote Campite (42.458570, -72.674732)
Parking (42.448013, -72.680663)


#FOREST AGGREGATION

```{r}
aggforests<-aggforests%>%
  group_by(Sheet1__Na)%>%
  summarise(combined=st_combine(geometry))

leaflet%>%
  addPolygons(data=aggforests$combined)

```
